googlenin VGG16 modelini indirdik 
import os
import tensorflow as tf
from tensorflow.keras import layers
from tensorflow.keras.applications import VGG16
import pandas as pd
import matplotlib.pyplot as plt

# --- 1. AYARLAR ---
TRAIN_DIR = './data/train'
VALID_DIR = './data/valid'

# Resimler 128x128 piksel boyutuna getirilecek (HÄ±z iÃ§in ideal)
IMG_SIZE = (128, 128)
BATCH_SIZE = 32

print("\nğŸš€ Veriler yÃ¼kleniyor...")

# --- 2. VERÄ° YÃœKLEME (DATA PIPELINE) ---
# EÄŸitim verisi
train_ds = tf.keras.utils.image_dataset_from_directory(
    TRAIN_DIR,
    image_size=IMG_SIZE,
    batch_size=BATCH_SIZE,
    label_mode='binary' # 0: Araba, 1: Kamyon (veya tam tersi)
)

# DoÄŸrulama verisi
val_ds = tf.keras.utils.image_dataset_from_directory(
    VALID_DIR,
    image_size=IMG_SIZE,
    batch_size=BATCH_SIZE,
    label_mode='binary'
)

# --- 3. MODELÄ° OLUÅTURMA (TRANSFER LEARNING) ---
print("ğŸ§  VGG16 Modeli hazÄ±rlanÄ±yor...")

# VGG16'nÄ±n sadece Ã¶zellik Ã§Ä±karan "Taban" kÄ±smÄ±nÄ± alÄ±yoruz
base_model = VGG16(
    input_shape=IMG_SIZE + (3,), # (128, 128, 3)
    include_top=False,           # Son katmanÄ± (karar vericiyi) almÄ±yoruz
    weights='imagenet'           # ImageNet aÄŸÄ±rlÄ±klarÄ±nÄ± kullan
)

# TabanÄ± donduruyoruz (Bu kÄ±smÄ± eÄŸitmeyeceÄŸiz, hazÄ±r bilgi kullanacaÄŸÄ±z)
base_model.trainable = False

# Kendi modelimizi inÅŸa ediyoruz
model = tf.keras.Sequential([
    # GiriÅŸ katmanÄ±nda pikselleri 0-255 arasÄ±ndan 0-1 arasÄ±na sÄ±kÄ±ÅŸtÄ±rÄ±yoruz
    layers.Rescaling(1./255, input_shape=IMG_SIZE + (3,)),
    
    base_model,                 # HazÄ±r Beyin (VGG16)
    layers.Flatten(),           # Veriyi dÃ¼zleÅŸtir
    layers.Dense(256, activation='relu'), # Ã–ÄŸrenen katman
    layers.Dropout(0.5),        # Ezberlemeyi Ã¶nleyen katman
    layers.Dense(1, activation='sigmoid') # Ã‡IKIÅ: 0 veya 1 kararÄ±
])

# --- 4. MODELÄ° DERLEME ---
model.compile(
    optimizer='adam',
    loss='binary_crossentropy',
    metrics=['binary_accuracy'],
)

# --- 5. EÄÄ°TÄ°MÄ° BAÅLAT ---
print("\nğŸ‹ï¸ EÄŸitim baÅŸlÄ±yor! (Mac performansÄ±na gÃ¶re biraz sÃ¼rebilir)...")

history = model.fit(
    train_ds,
    validation_data=val_ds,
    epochs=10,  # 10 Tur dÃ¶necek
    verbose=1
)

# --- 6. SONUÃ‡LARI GÃ–RSELLEÅTÄ°R ---
print("\nğŸ“Š Grafikler Ã§iziliyor...")

history_frame = pd.DataFrame(history.history)

# Grafik ayarlarÄ±
plt.figure(figsize=(12, 6))

# KayÄ±p (Loss) GrafiÄŸi - Ne kadar azsa o kadar iyi
plt.subplot(1, 2, 1)
plt.plot(history_frame['loss'], label='EÄŸitim KaybÄ±')
plt.plot(history_frame['val_loss'], label='DoÄŸrulama KaybÄ±')
plt.title('KayÄ±p (Loss) GrafiÄŸi')
plt.xlabel('Epoch (Tur)')
plt.legend()

# DoÄŸruluk (Accuracy) GrafiÄŸi - Ne kadar yÃ¼ksekse o kadar iyi
plt.subplot(1, 2, 2)
plt.plot(history_frame['binary_accuracy'], label='EÄŸitim DoÄŸruluÄŸu')
plt.plot(history_frame['val_binary_accuracy'], label='DoÄŸrulama DoÄŸruluÄŸu')
plt.title('DoÄŸruluk (Accuracy) GrafiÄŸi')
plt.xlabel('Epoch (Tur)')
plt.legend()

# GrafiÄŸi ekranda gÃ¶ster
plt.show()

print("âœ… Ä°ÅŸlem TamamlandÄ±!")